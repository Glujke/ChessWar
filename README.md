# Chess War - .NET Server Edition

## 1. Общее описание игры
**Жанр**: Стратегическая игра-RPG на основе шахмат.
**Сеттинг**: Мир, где шахматные фигуры оживают и сражаются.
**Стороны**: Эльфы (команда 1) vs Орки (команда 2).
**Цель**: Стратегическое планирование и тактические RPG-сражения.

## 2. Основные механики игры

### Кто управляет фигурами (простое объяснение)
В Chess War на поле есть две стороны: одна управляется человеком (игроком), другая — искусственным интеллектом (ИИ).
Каждая фигура на доске принадлежит либо игроку, либо ИИ. Это значит, что у каждой фигуры есть "хозяин" — тот, кто принимает за неё решения.
Когда вы делаете ход, вы управляете только своими фигурами. За противника все решения принимает компьютер (ИИ).
Таким образом, принадлежность фигуры определяется не по номеру или цвету, а по тому, кто ей управляет — человек или ИИ.

В архитектуре .NET сервера: есть абстрактный участник (`Participant`), от которого наследуются `Player` и `AI`, и фигуры связаны с этим участником. Проверки союзник/враг делаются по принадлежности к участнику, а не по ID.

### 2.1 Определение команд
**КРИТИЧЕСКИ ВАЖНО**: Принадлежность каждой фигуры определяется по её владельцу (игрок или ИИ). ID используется только для уникальной идентификации фигуры и не влияет на команду.

### 2.2 Базовые правила
**Временная система**:
- 1 ход = игрок тратит свою ману на действия с любыми фигурами. Игрок и противник ходят по очереди.
- В каждом ходе игрок:
  - Имеет **50 маны** (накапливается между ходами)
  - Может тратить ману на **движение** и **способности** любых своих фигур
  - Может делать **множественные действия** в одном ходе
  - **ОБЯЗАТЕЛЬНО** должен выполнить хотя бы одно действие перед завершением хода
  - Завершает ход когда захочет или когда мана закончится (автоматически)
- **Восстановление маны**:
  - **Первый ход**: игрок начинает с **10 маны** (не 50!)
  - **Последующие ходы**: игрок получает **+10 маны** (но не больше 50)
  - Мана накапливается между ходами (можно копить)

### 2.3 Правила движения и атаки

#### КРИТИЧЕСКИ ВАЖНО: Разделение правил движения и атаки
- **Движение**: Фигуры ходят по **классическим шахматным правилам** (с ограничением MP)
- **Атака**: Фигуры атакуют по **радиальной системе** (расстояние Чебышёва: max(|x₂ - x₁|, |y₂ - y₁|))

#### Радиальная система атак
**Формула расстояния**: Расстояние Чебышёва = max(|x₂ - x₁|, |y₂ - y₁|)

**Радиусы атак фигур**:
| Фигура | Радиус атаки | Особенности |
|--------|-------------|-------------|
| Пешка  | 1           | Только вперёд (прямо + по диагонали) |
| Конь   | 1           | В любом направлении |
| Слон   | 4           | В любом направлении |
| Ладья  | 8           | В любом направлении |
| Ферзь  | 3           | В любом направлении |
| Король | 1           | В любом направлении |

#### Препятствия при атаке
**ВАЖНО**: 
- **Обычные атаки**: НЕ проходят через препятствия (нужно проверять путь)
- **AOE атаки**: Проходят через препятствия (как "Магический взрыв" ферзя)

#### Препятствия при движении
**ВАЖНО**:
- **Большинство фигур**: НЕ могут проходить через препятствия при движении
- **Конь**: МОЖЕТ перепрыгивать через препятствия при движении (исключение из правил)
- **Условие для коня**: клетка назначения должна быть свободной или занятой врагом

## 3. Характеристики фигур и игроков:

### 3.1 Характеристики фигур:
- **HP** (здоровье) - когда достигает 0, фигура уничтожается.
- **Attack (ATK)** - сила атаки фигуры.
- **Attack Range** - дальность атаки фигуры (радиус по формуле Чебышёва).
- **Movement** - как далеко фигура может ходить за ход (по шахматным правилам).
- **Experience (XP)** - опыт для развития (каждая атака дает XP и позволяет развивать способности фигур).

### 3.2 Характеристики игрока:
- **MP** (мана) - энергия игрока для действий с фигурами (50 максимум, +10 за ход).
- **MaxMP** - максимальная мана игрока (50).
- **Начальная мана**: 10 маны в первом ходе, 50 маны в последующих ходах.
- **Обязательное действие**: игрок не может завершить ход без выполнения хотя бы одного действия.

### 3.3 Стоимость действий (мана игрока):
**Движение фигур**:
- **Пешка**: 1 мана за клетку
- **Конь**: 2 маны за клетку  
- **Слон**: 3 маны за клетку
- **Ладья**: 3 маны за клетку
- **Ферзь**: 4 маны за клетку
- **Король**: 4 маны за клетку (дорогой, но только 1 клетка)

**Способности** (дополнительно к движению):
- **Пешка**: Удар щитом (2 маны), Прорыв (2 маны)
- **Конь**: Двойной удар (5 мана), Железная стойка (4 маны)
- **Слон**: Стрела света (3 маны), Исцеление (6 мана)
- **Ладья**: Шквал стрел (7 мана), Крепость (8 мана)
- **Ферзь**: Магический взрыв (10 мана), Воскрешение (12 мана)
- **Король**: Королевский приказ (10 мана)

## 4. Типы фигур:
**Пешка (Pawn)** → **Конь/Слон (Knight/Bishop)** → **Ладья (Rook)** → **Ферзь (Queen)** → **Король (King)**.
**Принцип "эволюции"** для пешек превращается в специальные способности.

## 5. Фигуры и их способности:

### 5.1 Пешка (Pawn)
- **HP**: 10
- **ATK**: 2
- **Range**: 1
- **Movement**: 1
- **Exp**: 20
- **Движение**: 
  - 1 клетка вперед (1 мана игрока)
  - **Первый ход**: можно на 2 клетки вперед (2 маны игрока)
  - **Направление**: 
    - Команда 1 (Эльфы): вверх (y увеличивается)
    - Команда 2 (Орки): вниз (y уменьшается)
  - **Диагональная атака**: только при наличии врага по диагонали вперёд
- **Способности**:
  - **Удар щитом** (ближний бой, Range=1) - 2 урона, 2 маны игрока.
  - **Прорыв** (атака по диагонали, как в шахматах) - 3 урона, 2 маны игрока.
- **XP для эволюции**: 0/20 (или при достижении последней линии).

**ВАЖНО**: Первый ход определяется по позиции:
- Команда 1: пешка на позиции y=1 (вторая линия)
- Команда 2: пешка на позиции y=6 (седьмая линия)

### 5.2 Конь (Knight)
- **HP**: 20
- **ATK**: 4
- **Range**: 1
- **Movement**: 1
- **Exp**: 40
- **Движение**: Ход "буквой Г" за 2 маны игрока.
  - **ВАЖНО**: Конь может перепрыгивать через препятствия при движении
  - Главное условие: клетка назначения должна быть свободной или занятой врагом
- **Способности**:
  - **Двойной удар** - две атаки по 3 урона (Range=1), 5 мана игрока.
  - **Железная стойка** (CD=3) - +3 брони на ход, 4 маны игрока.
- **XP для эволюции**: 0/40.

### 5.3 Слон (Bishop)
- **HP**: 18
- **ATK**: 3
- **Range**: 4
- **Movement**: 8
- **Exp**: 40
- **Движение**: По диагонали на любое расстояние (3 маны игрока/клетка).
- **Способности**:
  - **Стрела света** (Range=4) - 4 урона, 3 маны игрока.
  - **Исцеление** (Range=2, CD=4) - +5 HP союзнику, 6 мана игрока.
- **XP для эволюции**: 0/40.

### 5.4 Ладья (Rook)
- **HP**: 25
- **ATK**: 5
- **Range**: 8
- **Movement**: 8
- **Exp**: 60
- **Движение**: По прямой на любое расстояние (3 маны игрока/клетка).
- **Способности**:
  - **Шквал стрел** (Range=8, CD=2) - 5 урона, 7 мана игрока.
  - **Крепость** (CD=5) - удваивает HP на ход, 8 мана игрока.
- **XP для эволюции**: 0/60.

### 5.5 Ферзь (Queen)
- **HP**: 30
- **ATK**: 7
- **Range**: 3
- **Movement**: 8
- **Exp**: 0 (эволюция не предусмотрена)
- **Движение**: Любое направление на любое расстояние (4 маны игрока/клетка).
- **Способности**:
  - **Магический взрыв** (Range=3) - 7 урона всем в зоне, 10 мана игрока (AOE - проходит через препятствия).
  - **Воскрешение** (CD=10) - оживляет союзника с 50% HP, 12 мана игрока.
- **XP для эволюции**: 0/100 (дальнейшие способности).

### 5.6 Король (King)
- **HP**: 50
- **ATK**: 3
- **Range**: 1
- **Movement**: 1
- **Exp**: 0 (эволюция не предусмотрена)
- **Движение**: 1 клетка в любом направлении (4 маны игрока).
- **Способности**:
  - **Аура морали** (пассивно) - +1 ATK союзникам в радиусе 3.
  - **Королевский приказ** (CD=6) - даёт ход другой фигуре, 10 мана игрока.

**Эволюционная система**:
- **Уровень эволюции**: При XP достижении (см. таблицу опыта ниже).
- **Эволюции**:
  - Пешка → Конь/Слон (при достижении последней линии или 20 XP).
  - Конь/Слон → Ладья (40 XP).
  - Ладья → Ферзь (60 XP).
  - Ферзь и король не эволюционируют (Exp=0).
- **Примечания**:
  - Восстановление MP происходит в начале хода.
  - CD способностей снижается в конце хода.

### 5.7 Система кулдаунов
**ВАЖНО**: Кулдауны снижаются в **конце хода** фигуры, а не в начале.

### 5.8 Получение XP и эволюция
- **Убийство вражеской фигуры** даёт XP убийце
- **Достижение последней линии пешкой** даёт **немедленную эволюцию** в коня или слона (на выбор игрока)

## 6. Условия победы/поражения
- **Победа**: Уничтожение вражеского короля
- **Поражение**: Уничтожение своего короля

## 7. Игровой процесс (пример):
**Ход**: Выполняется движение фигуры + атака (движение + атака + восстановление MP и CD).
**Цель**: Уничтожить все вражеские фигуры, развивать способности и эволюционировать.
**Результат**: При уничтожении XP получает игрок, фигура эволюционирует в конь/слон. При достижении последней линии пешка сразу эволюционирует в коня или слона.

### Как работает ход?
1. **Фаза действий** (повторяется пока есть мана):
   - Выбирается фигура → тратится мана игрока на движение → выполняется перемещение.
   - Фигура может ходить только в доступные клетки по шахматным правилам.
   - Можно переключаться между разными фигурами в одном ходе.
   - **ВАЖНО**: Игрок должен выполнить хотя бы одно действие!
2. **Фаза атаки и способностей**:
   - Атака по радиальной системе в пределах радиуса фигуры.
   - Использование способностей (тратится мана игрока).
   - Можно использовать способности разных фигур.
3. **Завершение хода**:
   - Игрок может завершить ход в любой момент (если мана > 0 и выполнено хотя бы одно действие).
   - Ход автоматически завершается при нулевой мане.
   - **Первый ход**: игрок начинает с 10 маны.
   - **Последующие ходы**: восстановление маны игрока (+10, максимум 50).

## 8. Режимы для мультиплеера:
**Этап 1**: Подготовка
- Игроки расставляют 8 пешек + короля.
- Цель: Стратегическое размещение фигур.
- Доступные действия: движение, атака, использование способностей.

**Этап 2**: Бой
- В каждом ходе игроки тратят свою ману на действия с любыми фигурами.
- Игрок может делать множественные действия в одном ходе (движение, атака, способности).
- Ход завершается когда игрок захочет или когда мана закончится.

**Этап 3**: Конец
- Победа и поражение + награды (опыт, ресурсы).
- Развитие способностей и эволюционирование фигур.

### Примеры использования маны игрока:

**Первый ход (10 мана)**:
- Пешка: движение на 1 клетку (1 мана) + Прорыв (2 маны) = 3 маны
- Пешка: движение на 2 клетки (2 маны) = 2 маны
- Пешка: движение на 1 клетку (1 мана) + Удар щитом (2 маны) = 3 маны
- **Итого**: 8 мана (остается 2 мана, можно копить)

**Агрессивный ход (50 мана)**:
- Пешка: движение на 2 клетки (2 маны) + Удар щитом (2 маны) = 4 маны
- Конь: движение (2 маны) + Двойной удар (5 мана) = 7 мана  
- Слон: движение на 3 клетки (9 мана) + Стрела света (3 маны) = 12 мана
- Ладья: движение на 2 клетки (6 мана) + Шквал стрел (7 мана) = 13 мана
- Ферзь: движение на 2 клетки (8 мана) + Магический взрыв (10 мана) = 18 мана
- **Итого**: 54 маны (превышает лимит, нужно выбрать меньше действий)

**Консервативный ход (30 мана)**:
- Пешка: движение на 1 клетку (1 мана) + Прорыв (2 маны) = 3 маны
- Конь: движение (2 маны) = 2 маны
- Слон: движение на 2 клетки (6 мана) = 6 мана
- Ладья: движение на 1 клетку (3 маны) = 3 маны
- **Итого**: 14 мана (остается 16 мана, можно копить)

**Экономичный ход (15 мана)**:
- Только пешки: 5 пешек по 1 клетке (5 маны) + 1 пешка с Прорывом (3 маны) = 8 мана
- **Итого**: 8 мана (остается 7 мана, можно копить на следующий ход)

## 9. Искусственный интеллект (ИИ) для одиночной игры

### 9.1 Архитектура ИИ

ИИ построен на основе **марковских цепей** и **матриц вероятностей**, что обеспечивает:
- **Адаптивность**: ИИ оценивает состояние и вероятности удачи действий
- **Настраиваемость**: Сложность регулируется не «сколько маны тратить», а параметрами принятия решений
- **Эффективность**: Быстрое принятие решений при заданном вычислительном бюджете

#### 9.1.1 Основные компоненты ИИ:

**1. ChessWarProbabilityMatrix** - Матрица вероятностей действий
- Оценивает вероятность успеха и ожидаемую ценность действия с учётом контекста
- Применяет модификаторы на основе позиции и состояния игры
- Использует кэширование для оптимизации

**2. MarkovDecisionAI** - Марковский ИИ для принятия решений
- Генерирует доступные действия
- Вычисляет Q-ценность действия (наградa + прогноз будущего состояния)
- Выбирает одно лучшее действие с учётом параметров сложности (температура, агрессия, приоритет способностей)

**3. GameStateEvaluator** - Оценка состояния игры
- Анализирует материальное преимущество (HP, ATK фигур)
- Учитывает позиционное преимущество (центр доски vs углы)
- Оценивает угрозы для короля и возможности эволюции
- Возвращает численную оценку от -1000 до +1000

**4. AIDifficultyProvider** - Провайдер уровня сложности
- Возвращает профиль параметров сложности: глубина просмотра, температура (τ), агрессия (α), приоритет способностей (β), ширина луча (K) и вычислительный бюджет

### 9.2 Алгоритм работы ИИ

#### 9.2.1 Основной цикл принятия решений:

1. **Проверка возможности хода**:
   - Есть ли живые фигуры у ИИ
   - Ограничения правилом хода (общие для игрока/ИИ)
   - Пропуск хода запрещён — при отсутствии хороших опций выбирается безопасное минимальное действие

2. **Генерация доступных действий**:
   - **Движения**: По шахматным правилам в пределах доски
   - **Атаки**: По радиальной системе в пределах радиуса фигуры
   - **Способности**: Для фигур с доступными способностями

3. **Выбор действия по уровню сложности**:
   - Параметры сложности задают depth/τ/α/β/K и бюджет
   - На лёгком уровне больше случайности, на сложном — глубже поиск и ниже температура

4. **Выполнение действия**:
   - Интеграция с TurnService для выполнения хода
   - Обновление состояния игры
   - Возврат результата выполнения

#### 9.2.2 Марковские цепи в действии:

**Состояния**: Позиции фигур, HP, мана игрока, кулдауны способностей
**Переходы**: Действия (движение, атака, способности)
**Вероятности**: Вычисляются на основе матрицы вероятностей
**Награды**: Q-значения на основе оценки состояния игры

### 9.3 Стратегии по уровням сложности

Параметры сложности управляют не расходом маны, а качеством поиска и характером решений:

- Easy
  - Depth: 1 плай
  - Temperature τ: высокая (больше случайности)
  - Aggression α: низкая; избегает рискованных обменов
  - AbilityBias β: низкий — способности применяются редко и безопасно
  - BeamWidth K: 3–4; небольшой набор кандидатов
  - Budget: малый (быстрые решения)

- Medium
  - Depth: 1–2 плая
  - Temperature τ: средняя
  - Aggression α: умеренная; берёт выгодные размены
  - AbilityBias β: средний — использует способности по эвристике полезности
  - BeamWidth K: 5–7; рассматривает топ кандидатов по Q
  - Budget: средний

- Hard
  - Depth: 2–3 плая (роллауты/минимакс с вероятностями)
  - Temperature τ: низкая (детерминированнее выбор)
  - Aggression α: высокая; допускает жертвы при ожидаемой выгоде
  - AbilityBias β: высокий — активно применяет способности/комбо
  - BeamWidth K: 10–15; расширенный поиск
  - Budget: повышенный (в рамках таймбокса)

### 9.4 Специальные правила ИИ

#### 9.4.1 Обязательные действия:
- **ИИ НИКОГДА не пропускает ход** без выполнения хотя бы одного действия
- Если нет доступных действий - ИИ пытается найти любое возможное действие
- Минимальное действие: движение пешки на 1 клетку (1 мана)

#### 9.4.2 Управление маной:
- ИИ следует тем же игровым правилам маны, что и игрок (ограничения трат диктуются правилами хода)
- Уровень сложности НЕ задаёт целевые траты маны; решения принимаются исходя из ценности действия и текущего бюджета поиска
- ИИ может копить ману или тратить её в зависимости от тактической выгоды

#### 9.4.3 Приоритеты действий:

**1. Защита короля** (высший приоритет):
- Если король под угрозой - все действия направлены на защиту
- Использует способности защиты (Крепость ладьи, Аура морали короля)
- Приоритет фигур: Ферзь > Ладья > Слон > Конь > Пешки

**2. Атака эволюционирующих фигур**:
- Если вражеская фигура близка к эволюции (XP > 80% от требуемого)
- ИИ фокусируется на уничтожении этой фигуры
- Использует дорогие способности для гарантированного убийства

**3. Материальное преимущество**:
- Атакует фигуры с низким HP
- Предпочитает атаковать сильные фигуры врага
- Защищает свои сильные фигуры

**4. Позиционное преимущество**:
- Стремится занять центр доски
- Использует дальнобойные фигуры (Слон, Ладья, Ферзь)
- Блокирует продвижение вражеских пешек

### 9.5 Примеры поведения ИИ

#### 9.5.1 Агрессивная стратегия (Hard):
```
Ход 1: Пешка (1 мана) + Конь (2 маны) + Слон (3 маны) = 6 маны
Ход 2: Ладья (3 маны) + Шквал стрел (7 маны) = 10 маны  
Ход 3: Ферзь (4 маны) + Магический взрыв (10 маны) = 14 маны
Итого: 30 маны за 3 хода
```

#### 9.5.2 Консервативная стратегия (Medium):
```
Ход 1: 2 пешки по 1 клетке (2 маны) + копить 8 маны
Ход 2: Конь (2 маны) + Двойной удар (5 маны) = 7 маны
Ход 3: Слон (3 маны) + Стрела света (3 маны) = 6 маны
Итого: 15 маны за 3 хода + накоплено 25 маны
```

#### 9.5.3 Экономичная стратегия (Easy):
```
Ход 1: 5 пешек по 1 клетке (5 маны) + копить 5 маны
Ход 2: 3 пешки по 1 клетке (3 маны) + копить 7 маны
Ход 3: 2 пешки по 1 клетке (2 маны) + копить 8 маны
Итого: 10 маны за 3 хода + накоплено 20 маны
```

### 9.6 Техническая реализация

#### 9.6.1 Классы и интерфейсы:
- `IProbabilityMatrix` - интерфейс матрицы вероятностей
- `ChessWarProbabilityMatrix` - реализация матрицы вероятностей
- `MarkovDecisionAI` - марковский ИИ
- `GameStateEvaluator` - оценка состояния игры
- `AIDifficultyProvider` - провайдер сложности
- `ProbabilisticAIService` - основной сервис ИИ

#### 9.6.2 Интеграция с игрой:
- ИИ вызывается через `IAIService.MakeAiTurn(GameSession)`
- Использует `TurnService` для выполнения действий
- Интегрируется с системой событий для логирования
- Поддерживает разные уровни сложности через DI

#### 9.6.3 Производительность:
- Кэширование вычислений вероятностей
- Оптимизированные алгоритмы поиска путей
- Минимальное использование памяти
- Быстрое принятие решений (< 100ms)

## 10. Сценарии для демо-версии:

### Сцена 1: Обучение
- Игрок управляет 8 пешками + король.
- Цель: Уничтожить вражеского короля.
- Пошаговые подсказки: как ходить, атаковать, использовать способности.

### Сцена 2: Бой
- У врага появляются конь и слон, а так же переносятся фигуры с предыдущей игры (в том числе и те, которые были уничтожены).
- Игрок должен прокачать пешку до ладьи, чтобы победить.

### Сцена 3: Босс
- Враг – король + ферзь (очень сильный).
- Нужно использовать тактику и прокачанные фигуры.

## 11. Технические особенности

### 11.1 Конфигурация
- Все характеристики фигур загружаются из базы данных (SQLite)
- Система поддерживает изменение параметров без перекомпиляции через REST API
- Версионирование баланса: редакторские версии + одна Active

### 11.2 Архитектура сервера (.NET)
- **ASP.NET Core 9.0** - веб-сервер для REST API
- **Clean Architecture** - разделение на слои: Domain, Application, Infrastructure, Persistence
- **Entity Framework Core** - ORM для работы с базой данных
- **SQLite** - база данных по умолчанию (легко заменить на PostgreSQL/SQL Server)
- **Dependency Injection** - встроенная система DI для управления зависимостями
- **Repository Pattern** - абстракция доступа к данным
- **CQRS** - разделение команд и запросов (планируется)

### 11.3 Клиент-серверная архитектура
- **Клиент**: Unreal Engine 4 - графический интерфейс и взаимодействие с пользователем
- **Сервер**: ASP.NET Core API - игровая логика, правила, ИИ
- **Протокол**: REST API с JSON
- **Связь**: HTTP/HTTPS запросы между клиентом и сервером

### 11.4 Система событий
- Логирование всех игровых действий в базе данных
- Возможность воспроизведения игры через API
- Отладочная информация через Swagger UI
- Аудит действий игроков

## 12. Частые ошибки и недопонимания

### 12.1 Движение vs Атака
**ОШИБКА**: Смешивание правил движения и атаки
- **Движение**: по шахматным правилам
- **Атака**: по радиальной системе

### 12.2 Направление пешки
**ОШИБКА**: Все пешки двигаются в одном направлении
- **Команда 1**: вверх (y увеличивается)
- **Команда 2**: вниз (y уменьшается)

### 12.3 Первый ход пешки
**ОШИБКА**: Неправильное определение первого хода
- **Команда 1**: пешка на y=1
- **Команда 2**: пешка на y=6

### 12.4 Радиус атаки
**ОШИБКА**: Использование шахматных правил для атак
- **Правильно**: Расстояние Чебышёва = max(|x₂ - x₁|, |y₂ - y₁|)
- **Неправильно**: Шахматные правила атаки

### 12.5 Препятствия при атаке
**ОШИБКА**: Блокировка радиальных атак препятствиями
- **Правильно**: Обычные атаки НЕ проходят через препятствия
- **Исключение**: AOE атаки проходят через препятствия

### 12.6 Препятствия при движении
**ОШИБКА**: Неправильная логика препятствий при движении
- **Правильно**: Большинство фигур НЕ могут проходить через препятствия
- **Исключение**: Конь МОЖЕТ перепрыгивать через препятствия при движении
- **ОШИБКА**: Конь не может перепрыгивать через препятствия
- **ПРАВИЛЬНО**: Конь может перепрыгивать через препятствия (шахматное правило)

### 12.7 Кулдауны
**ОШИБКА**: Снижение кулдаунов в начале хода
- **Правильно**: Кулдауны снижаются в конце хода

### 12.8 Определение команд
**ОШИБКА**: Неправильное определение команд
- **Правильно**: По владельцу фигуры (участнику партии)
- **Неправильно**: По ID или другим числовым признакам

## 13. Дополнительные возможности:
- Кампания одиночная (сюжетная линия, миссии).
- Случайные сражения (арена, турнир).
- Многопользовательские сражения (PvP).

## 14. Балансировка системы маны:

### 14.1 Экономика маны:
- **Первый ход**: 10 маны (ограничивает действия, заставляет планировать)
- **Последующие ходы**: 50 маны (позволяет сделать 1-2 мощные комбинации)
- **Восстановление**: +10 за ход (позволяет копить или тратить каждый ход)
- **Максимум**: 50 (нельзя накопить больше)
- **Обязательное действие**: игрок не может завершить ход без выполнения хотя бы одного действия

### 14.2 Стоимость действий (сбалансировано):
**Дешевые действия (1-3 маны)**:
- Пешка: движение (1), способности (2)
- Конь: движение (2), способности (4-5)

**Средние действия (3-8 маны)**:
- Слон: движение (3/клетка), способности (3-6)
- Ладья: движение (3/клетка), способности (7-8)

**Дорогие действия (4-12 маны)**:
- Ферзь: движение (4/клетка), способности (10-12)
- Король: движение (4), способности (10)

### 14.3 Правила первого хода:
- **Ограниченная мана**: только 10 маны (заставляет быть осторожным)
- **Обязательное действие**: игрок должен выполнить хотя бы одно действие
- **Планирование**: игрок должен решить, тратить всю ману или копить
- **Примеры первого хода**:
  - **Консервативно**: 2 пешки по 1 клетке (2 маны) + копить 8 маны
  - **Агрессивно**: 1 пешка с Прорывом (3 маны) + 1 пешка с Ударом щитом (3 маны) + 1 пешка на 2 клетки (2 маны) = 8 маны

### 14.4 Стратегические решения:
- **Агрессивная игра**: тратить всю ману каждый ход
- **Консервативная игра**: тратить 20-30 маны, копить остальное
- **Экономичная игра**: тратить только 10-20 маны, накапливать для мощных комбинаций

## 15. Дальнейшее развитие:
- Добавить магию (огненные шары, лечение).
- Ввести предметы (оружие, броня).
- Реализовать мультиплеер (PvP).

---

# Архитектура .NET сервера

## Принадлежность фигур и участников
- Принадлежность каждой фигуры определяется не по ID, а по владельцу (участнику партии).
- Участник партии может быть как человеком, так и искусственным интеллектом.
- Проверки союзник/враг всегда делаются по принадлежности к участнику, а не по каким-либо числовым признакам.
- Такая архитектура позволяет реализовать любые режимы: PvP, PvE, кооператив, несколько AI и т.д.

## Искусственный интеллект
- Искусственный интеллект — важная часть проекта, отвечает за принятие решений за противника.
- ИИ реализуется на сервере (.NET) с разными уровнями сложности, тактиками и сценариями поведения.
- Архитектура позволяет легко добавлять новые типы участников (например, несколько AI, кооператив, асимметричные режимы).

## Рекомендации по архитектуре
- Не использовать ID для определения команды или принадлежности.
- Всегда опираться на концепцию владельца фигуры (участника партии).
- Следовать принципам Clean Architecture и SOLID.
- Использовать Repository Pattern для абстракции доступа к данным.
- Применять Dependency Injection для управления зависимостями.

## API Endpoints

### Конфигурация
- `GET /api/v1/config/active` - получить активную конфигурацию
- `GET /api/v1/config/versions` - получить список версий конфигурации
- `POST /api/v1/config/versions` - создать новую версию конфигурации
- `PUT /api/v1/config/versions/{id}` - обновить версию конфигурации
- `POST /api/v1/config/versions/{id}/publish` - опубликовать версию

### Фигуры
- `GET /api/v1/pieces` - получить все фигуры
- `GET /api/v1/pieces/{team}` - получить фигуры команды
- `GET /api/v1/pieces/alive` - получить живые фигуры
- `POST /api/v1/pieces` - создать фигуру
- `PUT /api/v1/pieces/{id}` - обновить фигуру
- `DELETE /api/v1/pieces/{id}` - удалить фигуру

### Доска
- `GET /api/v1/board` - получить состояние доски
- `POST /api/v1/board/reset` - сбросить доску
- `POST /api/v1/board/setup` - настроить начальную расстановку
- `POST /api/v1/board/place` - разместить фигуру на доске

### Игровые действия (планируется)
- `GET /api/v1/game/moves/{pieceId}` - получить доступные ходы
- `POST /api/v1/game/move` - выполнить ход
- `POST /api/v1/game/attack` - выполнить атаку
- `POST /api/v1/game/ability` - использовать способность
- `POST /api/v1/game/evolve` - эволюционировать фигуру

## Технологический стек

### Backend (.NET)
- **ASP.NET Core 9.0** - веб-фреймворк
- **Entity Framework Core** - ORM
- **SQLite** - база данных (по умолчанию)
- **xUnit** - тестирование
- **FluentAssertions** - assertions для тестов
- **Swagger/OpenAPI** - документация API

### Frontend (Unreal Engine 4)
- **Unreal Engine 4** - игровой движок
- **C++** - логика клиента
- **HTTP Client** - взаимодействие с API
- **JSON** - формат данных

### Инфраструктура
- **Git** - система контроля версий
- **Docker** - контейнеризация (планируется)
- **CI/CD** - автоматизация развертывания (планируется)
